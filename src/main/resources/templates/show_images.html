<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Show Images</title>

    <script>

        let currentPage = 1; // 현재 페이지 번호
        let currentTable = null; // 현재 선택된 테이블

        // 사용자가 선택한 테이블에 따라 이미지를 로드하는 함수
        function submitSelection() {

            // Document 객체 : 웹 페이지 그 자체(웹 페이지에 존재하는 html 요소에 접근)
            const radios = document.querySelectorAll('input[name="table"]'); // 라디오 버튼을 모두 가져옴
            for (let radio of radios) { // 각 라디오 버튼에 대하여
                if (radio.checked) { // 선택된 버튼이면
                    currentTable = radio.value; // 해당 테이블 값을 저장하고
                    break; // 반복 종료
                }
            }
            if (!currentTable) { // 테이블이 선택되지 않았으면
                alert("조건을 선택해주세요!"); // 알림 메시지 표시
                return; // 함수 종료
            }

            // getElementById : 아이디 요소 선택
            document.getElementById('selection').style.display = 'none'; // 선택창 숨김
            document.getElementById('imageDisplay').style.display = 'block'; // 이미지 페이지 표시
            loadImages(); // 이미지 로드 함수 호출
        }

        // 페이지를 이동하는 함수 (이전/다음 버튼 클릭 시)
        function changePage(offset) {
            currentPage += offset; // 현재 페이지 번호를 업데이트
            loadImages(); // 이미지 로드 함수 호출
        }

        // 이미지를 로드하는 함수
        function loadImages() {
            fetch(`/getImage?page=${currentPage}&condition=${currentTable}`) // 서버에 이미지 데이터 요청
                .then(response => response.json()) // 응답을 JSON 형식으로 파싱
                .then(data => { // 데이터 처리
                    if (data.length == 0) { // 이미지 데이터가 없으면
                        window.location.href = "ImageFinish"; // 다른 페이지로 리다이렉트
                    }
                    displayImages(data); // 이미지 표시 함수 호출
                });
        }

        // 받아온 이미지 데이터를 표시하는 함수
        function displayImages(data) {

            const image1Data = "data:image/jpeg;base64," + data[0];
            const image2Data = data[1] ? "data:image/jpeg;base64," + data[1] : '';

            document.getElementById('image1').src = image1Data; // 첫 번째 이미지 표시
            document.getElementById('image2').src = image2Data; // 두 번째 이미지 표시 (있으면)
        }
    </script>
</head>

<body>
    <div id="selection">
        <p>조건 선택</p>
        <label>
            <input type="radio" name="table" value="test1"> Test1
        </label>
        <label>
            <input type="radio" name="table" value="test2"> Test2
        </label>
        <button onclick="submitSelection()">Submit</button>
    </div>

    <div id="imageDisplay" style="display:none;">
        <img id="image1" alt="Image 1" width="300" height="300">
        <img id="image2" alt="Image 2" width="300" height="300">
        <div>
            <button onclick="changePage(-1)">Previous</button>
            <button onclick="changePage(1)">Next</button>
        </div>
        <div>
            <input type="text" placeholder="식물 일지 입력" class="text" required>
        </div>
    </div>
</body>
</html>
